# UI

Built with React and Vite.

## Directory Structure

```text
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ animations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Animations.tsx
‚îÇ   ‚îú‚îÄ‚îÄ knowledge-base/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ KnowledgeTable.tsx
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArchonChatPanel.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainLayout.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SideNavigation.tsx
‚îÇ   ‚îú‚îÄ‚îÄ mcp/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MCPClients.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ToolTestingPanel.tsx
‚îÇ   ‚îú‚îÄ‚îÄ project-tasks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BlockNoteEditor.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DataTab.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocsTab.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DraggableTaskCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FeaturesTab.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Tabs.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskBoardView.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskTableView.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VersionHistoryModal.tsx
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ APIKeysSection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FeaturesSection.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IDEGlobalRules.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RAGSettings.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TestStatus.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Badge.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Card.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Select.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ThemeToggle.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Toggle.tsx
‚îÇ   ‚îú‚îÄ‚îÄ CrawlingProgressCard.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ProjectCreationProgressCard.tsx
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îú‚îÄ‚îÄ SettingsContext.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ThemeContext.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ToastContext.tsx
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useNeonGlow.ts
‚îÇ   ‚îî‚îÄ‚îÄ useStaggeredEntrance.ts
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ projectSchemas.ts
‚îÇ   ‚îú‚îÄ‚îÄ task-utils.tsx
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ KnowledgeBasePage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ MCPPage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ProjectPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ SettingsPage.tsx
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ agentChatService.ts
‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îú‚îÄ‚îÄ crawlProgressService.ts
‚îÇ   ‚îú‚îÄ‚îÄ credentialsService.ts
‚îÇ   ‚îú‚îÄ‚îÄ knowledgeBaseService.ts
‚îÇ   ‚îú‚îÄ‚îÄ mcpClientService.ts
‚îÇ   ‚îú‚îÄ‚îÄ mcpServerService.ts
‚îÇ   ‚îú‚îÄ‚îÄ mcpService.ts
‚îÇ   ‚îú‚îÄ‚îÄ projectCreationProgressService.ts
‚îÇ   ‚îú‚îÄ‚îÄ projectService.ts
‚îÇ   ‚îú‚îÄ‚îÄ testService.ts
‚îÇ   ‚îî‚îÄ‚îÄ webSocketService.ts
‚îî‚îÄ‚îÄ types/
    ‚îú‚îÄ‚îÄ knowledge.ts
    ‚îî‚îÄ‚îÄ project.ts
```

## Environment Variables

| Variable                  | Description                       |
|---------------------------|-----------------------------------|
| VITE_API_URL              | Backend API base URL              |
| VITE_API_BASE_URL         | Base URL used by some services    |

## Running Locally

```bash
cd archon-ui-main
npm install
npm run dev
```

## Component Communication

```mermaid
%%{init:{
  'theme':'base',
  'themeVariables': {
    'primaryColor':'#0a0a0a',
    'primaryTextColor':'#ffffff',
    'primaryBorderColor':'#6f55ff',
    'secondaryColor':'#111111',
    'secondaryBorderColor':'#3fb1ff',
    'tertiaryColor':'#1a1a1a',
    'tertiaryBorderColor':'#00d38a',
    'lineColor':'#3fb1ff',
    'textColor':'#ffffff',
    'fontFamily':'Inter',
    'fontSize':'14px',
    'background':'#0a0a0a',
    'mainBkg':'#111111',
    'secondBkg':'#1a1a1a',
    'clusterBkg':'rgba(17, 17, 17, 0.8)',
    'nodeTextColor':'#ffffff'
  }
}}%%
flowchart LR
  A["User"] --> B["React Form"]
  B --> C["API Call"]
  C --> D["Display Answer"]
```

See [Getting Started](getting-started) for details.

# Archon UI - Knowledge Engine Web Interface

A modern React-based web interface for the Archon Knowledge Engine MCP Server. Built with TypeScript, Vite, and Tailwind CSS.

## üé® UI Overview

Archon UI provides a comprehensive dashboard for managing your AI's knowledge base:

![UI Architecture](https://via.placeholder.com/800x400?text=Archon+UI+Architecture)

### Key Features

- **üìä MCP Dashboard**: Monitor and control the MCP server
- **‚öôÔ∏è Settings Management**: Configure credentials and RAG strategies
- **üìö Knowledge Management**: Browse, search, and organize knowledge items
- **üìà Real-time Updates**: Socket.IO-based live updates across the UI

## üèóÔ∏è Architecture

### Technology Stack

- **React 18.3**: Modern React with hooks and functional components
- **TypeScript**: Full type safety and IntelliSense support
- **Vite**: Fast build tool and dev server
- **Tailwind CSS**: Utility-first styling
- **Framer Motion**: Smooth animations and transitions
- **Lucide Icons**: Beautiful and consistent iconography
- **React Router**: Client-side routing


## üìÑ Pages Documentation

### 1. Knowledge Base (`/`)

Browse and manage your knowledge items with multiple view modes.

**Components:**
- **Knowledge Grid**: Card-based knowledge display with domain grouping
- **Knowledge Table**: Full-width table view with sortable columns
- **Search/Filter**: Search by title, type, tags
- **Crawling Progress**: Real-time progress tracking for URL crawling
- **Actions**: Delete, add sources, file upload

**Features:**
- Grid and table view modes
- Real-time updates via Socket.IO
- Type-based filtering (technical/business)
- Domain-based grouping for URLs
- Tag tooltips for overflow
- Progress tracking for crawling operations

### 2. Projects (`/projects`)

Project dashboard with task management and documentation tabs.

**Components:**
- **Project List**: Create and select projects
- **Task Tabs**: Manage tasks, features, docs and data
- **Progress Cards**: Real-time project creation status

**Features:**
- Hierarchical tasks
- GitHub repository links
- Socket.IO project progress

### 3. Settings (`/settings`)

Comprehensive configuration management with organized sections.

**Sections:**
- **Features**: 
  - Projects toggle (enable/disable Projects feature)
  - Other feature flags
- **API Keys**: 
  - OpenAI API key (encrypted storage)
  - Other API credentials
- **RAG Settings**:
  - Contextual Embeddings toggle
  - Hybrid Search toggle
  - Agentic RAG (code extraction) toggle
  - Reranking toggle
  - Model selection
- **Archon Unit Tests** (Collapsible):
  - Python MCP tests with real-time output
  - React UI tests with local execution
  - Pretty/Raw view modes
  - Error summary display

**Features:**
- Secure credential storage with encryption
- Real-time test execution and monitoring
- Toast notifications for actions
- Collapsible test section (collapsed by default)

### 4. MCP Dashboard (`/mcp`)

Central control panel for the MCP server.

**Components:**
- **Server Control Panel**: Start/stop server, view status, select transport mode
- **Server Logs Viewer**: Real-time log streaming with auto-scroll
- **Available Tools Table**: Dynamic tool discovery and documentation
- **MCP Test Panel**: Interactive tool testing interface

**Features:**
- Dual transport support (SSE/stdio)
- Real-time status polling (5-second intervals)
- Socket.IO-based log streaming
- Copy-to-clipboard configuration
- Tool parameter validation

Browse and manage your knowledge items.

**Components:**
- **Knowledge Grid**: Card-based knowledge display
- **Search/Filter**: Search by title, type, tags
- **Knowledge Details**: View full item details
- **Actions**: Delete, refresh, organize

**Features:**
- Pagination support
- Real-time updates via Socket.IO
- Type-based filtering (technical/business)
- Metadata display


## üß© Component Library

### Base UI Components

#### Button
```tsx
<Button 
  variant="primary|secondary|ghost" 
  size="sm|md|lg"
  accentColor="blue|green|purple|orange|pink"
  onClick={handleClick}
>
  Click me
</Button>
```

#### Card
```tsx
<Card accentColor="blue" className="p-6">
  <h3>Card Title</h3>
  <p>Card content</p>
</Card>
```

#### LoadingSpinner
```tsx
<LoadingSpinner size="sm|md|lg" />
```

### Layout Components

#### Sidebar
- Collapsible navigation
- Active route highlighting
- Icon + text navigation items
- Responsive design

#### Header
- Dark mode toggle
- User menu
- Breadcrumb navigation

### Animation Components

#### PageTransition
Wraps pages with smooth fade/slide animations:
```tsx
<PageTransition>
  <YourPageContent />
</PageTransition>
```

## üîå Socket.IO Integration

All real-time connections in the frontend now use **Socket.IO** through the WebSocketService for improved reliability:

### Key Services Using Socket.IO

| Service | Purpose | Status |
|---------|---------|--------|
| `crawlProgressService` | Progress tracking for crawling | ‚úÖ Socket.IO |
| `webSocketService` | Socket.IO client wrapper | ‚úÖ Socket.IO |
| `taskUpdateService` | Real-time task updates | ‚úÖ Socket.IO |
| `agentChatService` | Agent chat streaming | ‚úÖ Socket.IO |

### Socket.IO Usage Pattern

```typescript
import { createWebSocketService } from './services/webSocketService';

// Create service
const wsService = createWebSocketService({
  maxReconnectAttempts: 5,
  reconnectInterval: 1000
});

// Connect to Socket.IO namespace (automatically mapped)
await wsService.connect('/api/endpoint');

wsService.addMessageHandler('message_type', (message) => {
  // Handle message
});

// Clean up
wsService.disconnect();
```

### Component Integration

```typescript
useEffect(() => {
  const ws = createWebSocketService();
  
  ws.addMessageHandler('update', (data) => {
    setState(data);
  });
  
  ws.connect('/api/endpoint');
  
  return () => ws.disconnect();
}, []); // Only stable dependencies
```

## üîå Services

### mcpService
Handles all MCP server communication:
- `startServer()`: Start the MCP server
- `stopServer()`: Stop the MCP server
- `getStatus()`: Get current server status
- `streamLogs()`: Socket.IO log streaming
- `getAvailableTools()`: Fetch MCP tools

### api
Base API configuration with:
- Automatic error handling
- Request/response interceptors
- Base URL configuration
- TypeScript generics

### chatService
RAG query interface:
- `sendMessage()`: Send RAG query
- `streamResponse()`: Stream responses
- `getSources()`: Get available sources

## üé® Styling

### Tailwind Configuration
- Custom color palette
- Dark mode support
- Custom animations
- Responsive breakpoints

### Theme Variables
```css
--primary: Blue accent colors
--secondary: Gray/neutral colors
--success: Green indicators
--warning: Orange indicators
--error: Red indicators
```

## üöÄ Development

### Setup
```bash
# Install dependencies
npm install

# Start dev server
npm run dev

# Build for production
npm run build

# Run tests
npm test
```

### Environment Variables
```env
VITE_API_URL=http://localhost:8080
VITE_API_BASE_URL=http://localhost:8080
```

### Hot Module Replacement
Vite provides instant HMR for:
- React components
- CSS modules
- TypeScript files

## üß™ Testing

### Unit Tests
- Component testing with React Testing Library
- Service mocking with MSW
- Hook testing with @testing-library/react-hooks

### Integration Tests
- Page-level testing
- API integration tests
- Socket.IO testing

## üì¶ Build & Deployment

### Docker Support
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build
EXPOSE 5173
CMD ["npm", "run", "preview"]
```

### Production Optimization
- Code splitting by route
- Lazy loading for pages
- Image optimization
- Bundle size analysis

## üîß Configuration Files

### vite.config.ts
- Path aliases
- Build optimization
- Development server config

### tsconfig.json
- Strict type checking
- Path mappings
- Compiler options

### tailwind.config.js
- Custom theme
- Plugin configuration
- Purge settings

## ‚úÖ Frontend Development Standards

### Socket.IO Best Practices

**DO:**
- ‚úÖ Use WebSocketService (Socket.IO) for all real-time connections
- ‚úÖ Clean up connections in useEffect return
- ‚úÖ Handle all connection states (connecting, connected, failed)
- ‚úÖ Use typed message handlers

**DON'T:**
- ‚ùå Create direct WebSocket instances with `new WebSocket()` or native Socket.IO clients
- ‚ùå Include unstable functions in useCallback dependencies
- ‚ùå Forget to handle reconnection scenarios
- ‚ùå Create multiple connections to the same endpoint

### Stable Dependencies Pattern

```typescript
// ‚úÖ CORRECT: Only stable dependencies
const handleUpdate = useCallback(() => {
  updateData(value);
  showToast('Updated', 'success'); // Can call without dependency
}, [value]); // Only primitive values

// ‚ùå WRONG: Unstable function dependencies
const handleUpdate = useCallback(() => {
  updateData(value);
  showToast('Updated', 'success');
}, [value, showToast]); // showToast causes re-renders
```

### Event Handling Pattern

**Single Source of Truth**: Avoid duplicate event handlers for the same action.

```typescript
// ‚úÖ CORRECT: One place handles completion
const handleSocketMessage = (message) => {
  if (message.type === 'completed') {
    showToast('Operation completed', 'success');
    refreshData();
  }
};

// ‚ùå WRONG: Multiple handlers for same event
// In Socket.IO handler:
showToast('Operation completed', 'success');
// In API callback:
showToast('Operation completed', 'success');
// Causes duplicate toasts!
```

